<div id="setupWizard" class="setup-wizard-container">
    <div class="wizard-content">
        <div class="wizard-header">
            <img src="Assets/Proquotelyasset-25.png" onerror="this.src='https://placehold.co/150x50/1e293b/ffffff?text=Logo';" alt="Proquotely Logo" class="wizard-logo">
            <h2>Project Setup</h2>
            <p>Let's configure your estimate for accuracy and a professional look.</p>
        </div>

        <!-- Stepper (Updated for 4 steps) -->
        <div class="progress-container">
            <div class="progress-bar-background">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="step-indicators-wrapper">
                <!-- Step 1: Project Info & Trades (MERGED) -->
                <div id="step1Container" class="step-item active">
                    <div class="step-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                    </div>
                    <div class="step-label">Project Info</div>
                    <div class="step-subtext">Details & Trades</div>
                </div>
                <!-- Step 2: Labor Rates -->
                <div id="step2Container" class="step-item">
                    <div class="step-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                    </div>
                    <div class="step-label">Labor Rates</div>
                    <div class="step-subtext">Configure your team</div>
                </div>
                <!-- NEW Step 3: Smart Scope Builder -->
                <div id="step3Container" class="step-item">
                    <div class="step-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25H12M12 7.5h-1.5m1.5 3h-1.5m7.5-3h-3.375c-.621 0-1.125-.504-1.125-1.125V4.5c0-.621.504-1.125 1.125-1.125H20.25a1.125 1.125 0 011.125 1.125v4.5A1.125 1.125 0 0120.25 9H16.875a1.125 1.125 0 00-1.087.75l-.47 1.25a1.125 1.125 0 001.087 1.5H20.25Z" /></svg>
                    </div>
                    <div class="step-label">Smart Scope</div>
                    <div class="step-subtext">AI Document Analysis</div>
                </div>
                <!-- Step 4: Financial Settings (Updated) -->
                <div id="step4Container" class="step-item">
                    <div class="step-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-1.007 1.11-1.226l.28-.082c.22-.065.45-.098.688-.098h1.104c.238 0 .468.033.688.098l.28.082c.55.219 1.02.684 1.11 1.226l.068.418c.28.28.54.592.772.932l.217.324c.445.668.653 1.48.553 2.286l-.043.342c-.035.275-.083.543-.145.805l-.03.123a3.375 3.375 0 01-.63 1.08l-.21.282c-.6.8-1.29 1.433-2.046 1.954l-.4.293a3.375 3.375 0 01-1.07 1.082l-.293.189c-.69.444-1.45.752-2.228.914l-.422.093a3.375 3.375 0 01-1.423.045l-.342-.043a3.375 3.375 0 01-1.252-.38l-.355-.21a3.375 3.375 0 01-1.082-1.07l-.293-.4c-.522-.756-.99-1.59-1.328-2.455l-.123-.305a3.375 3.375 0 01-.145-.805l-.043-.342a3.375 3.375 0 01.553-2.286l.217-.324c.232-.34.492-.652.772-.932l.068-.418z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    </div>
                    <div class="step-label">Financials</div>
                    <div class="step-subtext">Apply Markups</div>
                </div>
            </div>
        </div>

        <!-- This div is now OUTSIDE the step-specific content for correct positioning -->
        <div id="tradesDropdown" class="multi-select-dropdown hidden"></div>

        <!-- Step 1: Project Info & Trades (Contents unchanged from your consolidated version) -->
        <div id="wizardStep1" class="wizard-step-content">
            <div class="step-grid">
                <!-- Left Column: Form Fields -->
                <div class="form-column">
                    <div class="form-section">
                        <div class="form-section-header">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                            <h4>Project Details</h4>
                        </div>
                        <div class="form-section-content">
                            <div class="form-group">
                                <label for="projectName" class="label">Project Name:</label>
                                <!-- FIXED: Removed static value="Commercial Construction Project" -->
                                <input type="text" id="projectName" class="input-field" required data-guidance-id="projectName">
                            </div>
                            <div class="form-group">
                                <label for="projectType" class="label">Project Type:</label>
                                <select id="projectType" class="input-field" required data-guidance-id="projectType">
                                    <option value="Commercial">Commercial</option>
                                    <option value="Residential">Residential</option>
                                    <option value="Industrial">Industrial</option>
                                    <option value="Renovation">Renovation</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-header">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" /></svg>
                            <h4>Client & Location</h4>
                        </div>
                        <div class="form-section-content">
                            <div class="form-group">
                                <label for="clientName" class="label">Client Name/Company:</label>
                                <!-- FIXED: Removed static value placeholder from input, keeping prompt placeholder -->
                                <input type="text" id="clientName" class="input-field" placeholder="e.g., Acme Corp." required data-guidance-id="clientName">
                            </div>
                            <div class="form-group">
                                <label for="projectState" class="label">State/Location:</label>
                                <select id="projectState" class="input-field" required data-guidance-id="projectState">
                                    <option value="CA">California</option>
                                    <option value="TX">Texas</option>
                                    <option value="NY">New York</option>
                                    <option value="FL">Florida</option>
                                    <option value="WA">Washington</option>
                                    <option value="IL">Illinois</option>
                                    <option value="AL">Alabama</option> <option value="AK">Alaska</option> <option value="AZ">Arizona</option> <option value="AR">Arkansas</option> <option value="CO">Colorado</option> <option value="CT">Connecticut</option> <option value="DE">Delaware</option> <option value="GA">Georgia</option> <option value="HI">Hawaii</option> <option value="ID">Idaho</option> <option value="IN">Indiana</option> <option value="IA">Iowa</option> <option value="KS">Kansas</option> <option value="KY">Kentucky</option> <option value="LA">Louisiana</option> <option value="ME">Maine</option> <option value="MD">Maryland</option> <option value="MA">Massachusetts</option> <option value="MI">Michigan</option> <option value="MN">Minnesota</option> <option value="MS">Mississippi</option> <option value="MO">Missouri</option> <option value="MT">Montana</option> <option value="NE">Nebraska</option> <option value="NV">Nevada</option> <option value="NH">New Hampshire</option> <option value="NJ">New Jersey</option> <option value="NM">New Mexico</option> <option value="NC">North Carolina</option> <option value="ND">North Dakota</option> <option value="OH">Ohio</option> <option value="OK">Oklahoma</option> <option value="OR">Oregon</option> <option value="PA">Pennsylvania</option> <option value="RI">Rhode Island</option> <option value="SC">South Carolina</option> <option value="SD">South Dakota</option> <option value="TN">Tennessee</option> <option value="UT">Utah</option> <option value="VT">Vermont</option> <option value="VA">Virginia</option> <option value="WV">West Virginia</option> <option value="WI">Wisconsin</option> <option value="WY">Wyoming</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-header">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" /></svg>
                            <h4>Trades Involved</h4>
                        </div>
                        <div class="form-section-content">
                            <div class="form-group">
                                <div class="multi-select-container">
                                    <input type="text" id="tradeSearchInput" class="input-field" placeholder="Search trades..." data-guidance-id="tradesInvolved">
                                    <div id="selectedTradesDisplay" class="selected-trades-display mt-2">
                                        Click to select trades...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Guidance & Logo -->
                <div class="guidance-column">
                    <input type="file" id="logoUploadInput" accept="image/*" style="display: none;">
                    <div id="logoUploadArea" class="logo-upload-area" data-guidance-id="logoUpload">
                        <img id="wizardLogoPreview" class="uploaded-logo hidden" src="" alt="Contractor Logo Preview">
                        <div id="placeholderContent" class="placeholder-content">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
                            <span class="upload-text">Attach Company Logo</span>
                            <span class="upload-subtext">Click or drag & drop</span>
                        </div>
                        <div id="clearLogoBtn" class="clear-logo-btn hidden">&times;</div>
                    </div>

                    <div id="guidanceCard" class="guidance-card">
                        <h4 id="guidanceTitle">Smart Suggestions</h4>
                        <p id="guidanceText">As you fill out the form, we'll provide helpful tips and information right here.</p>
                    </div>

                    <div class="text-center">
                        <a href="#" class="advanced-link" id="showAdvancedDetailsLink">Show Advanced Details</a>
                    </div>
                </div>
            </div>

            <div id="advancedDetailsSection" class="hidden mt-4">
                <div class="step-grid">
                    <div class="form-column">
                        <div class="form-section">
                            <div class="form-section-header">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" /></svg>
                                <h4>Address & ID</h4>
                            </div>
                            <div class="form-section-content">
                                <div class="form-group">
                                    <label for="projectAddress" class="label">Project Street Address:</label>
                                    <input type="text" id="projectAddress" class="input-field" placeholder="e.g., 123 Main St.">
                                </div>
                                <div class="form-group">
                                    <label for="projectCity" class="label">City:</label>
                                    <input type="text" id="projectCity" class="input-field" placeholder="e.g., Anytown">
                                </div>
                                <div class="form-group">
                                    <label for="projectZip" class="label">Zip Code:</label>
                                    <input type="text" id="projectZip" class="input-field" placeholder="e.g., 90210">
                                </div>
                                <div class="form-group">
                                    <label for="projectID" class="label">Project ID/Number:</label>
                                    <input type="text" id="projectID" class="input-field" placeholder="e.g., PROJ-001">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="guidance-column">
                        <div class="form-section">
                            <div class="form-section-header">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M-4.5 12h18" /></svg>
                                <h4>Dates & Scope</h4>
                            </div>
                            <div class="form-section-content">
                                <div class="form-group">
                                    <label for="startDate" class="label">Start Date:</label>
                                    <input type="date" id="startDate" class="input-field">
                                </div>
                                <div class="form-group">
                                    <label for="endDate" class="label">End Date (Optional):</label>
                                    <input type="date" id="endDate" class="input-field">
                                </div>
                                <div class="form-group">
                                    <label for="projectDescription" class="label">Project Description:</label>
                                    <textarea id="projectDescription" class="input-field" rows="4"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Labor Rates (Unchanged) -->
        <div id="wizardStep2" class="wizard-step-content hidden">
            <div class="text-center mb-8">
                <h2 class="step-title">Labor Rates & Skills</h2>
                <p class="step-subtitle mx-auto">Configure the hourly rates for each skill level within your selected trades. You can also add or remove custom skill levels.</p>
            </div>
            <div id="dynamicLaborRateInputs" class="max-w-3xl mx-auto flex flex-col gap-6"> 
                <!-- Dynamic content here -->
            </div>
            <div class="mt-6 text-center">
                <a href="#" class="advanced-link" id="advancedLink">Show Advanced Skill Options</a>
            </div>
            <div id="advancedSkillLevelControls" class="hidden mt-6 pt-6 border-t border-gray-200 dark:border-gray-700 max-w-md mx-auto">
                <h4 class="font-semibold text-lg mb-3 text-center">Add Custom Skill to All Trades</h4>
                <div class="form-group">
                    <label for="newSkillTitle" class="label">New Skill Title:</label>
                    <input type="text" id="newSkillTitle" class="input-field" placeholder="e.g., Lead Journeyman">
                </div>
                <div class="form-group">
                    <label for="newSkillRate" class="label">New Skill Rate ($/hr):</label>
                    <input type="number" id="newSkillRate" class="input-field" value="0">
                </div>
                <button id="addSkillLevelBtn" class="btn btn-primary w-full mt-2">Add Skill Level</button>
            </div>
        </div>

        <!-- NEW Step 3: Smart Scope Builder -->
        <div id="wizardStep3" class="wizard-step-content hidden">
            <div class="text-center mb-8">
                <h2 class="step-title">Smart Scope Builder</h2>
                <p class="step-subtitle mx-auto">Analyze project documents to instantly generate a comprehensive scope of work and task line items.</p>
            </div>
            <div class="step-grid">
                <!-- Left Column: Document Upload & Controls -->
                <div class="form-column">
                    <div class="form-section">
                        <div class="form-section-header">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
                            <h4>Upload Documents (PDF / DOCX)</h4>
                        </div>
                        <div class="form-section-content">
                            <input type="file" id="documentUploadInput" accept=".pdf,.docx" multiple style="display: none;">
                            <div id="documentUploadArea" class="logo-upload-area" data-guidance-id="documentUpload">
                                <div id="uploadPlaceholderContent" class="placeholder-content">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                                    <span class="upload-text">Drag & drop files here, or click to select</span>
                                    <p class="upload-subtext" id="uploadStatusText">Supported: PDF, DOCX (Max 50MB)</p>
                                </div>
                            </div>
                            
                            <!-- NEW FILE LIST CONTAINER -->
                            <div id="uploadedFilesContainer" class="mt-4 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden hidden">
                                <!-- Files will be dynamically rendered here -->
                            </div>

                            <div class="mt-4">
                                <button id="analyzeDocumentsBtn" class="btn btn-blue-solid w-full opacity-50 cursor-not-allowed" disabled data-guidance-id="analyze">Analyze Documents & Generate Scope</button>
                            </div>

                            <!-- Processing Progress -->
                            <div id="processingProgressContainer" class="hidden mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg dark:bg-blue-900 dark:border-blue-700">
                                <div class="flex items-center gap-2">
                                    <svg class="animate-spin h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                    <span id="progressMessage" class="font-medium text-blue-800 dark:text-blue-300">Starting analysis...</span>
                                </div>
                            </div>
                            
                            <!-- Optional Toggles -->
                            <div class="mt-6 border-t pt-4 border-gray-200 dark:border-gray-700" data-guidance-id="optionalFeatures">
                                <h5 class="font-semibold mb-2 text-sm text-gray-700 dark:text-gray-300">Optional Features</h5>
                                <div class="flex items-center justify-between mb-2">
                                    <label for="optionalCitationsToggle" class="label mb-0">Include Reference Citations:</label>
                                    <input type="checkbox" id="optionalCitationsToggle" class="toggle-switch">
                                </div>
                                <div class="flex items-center justify-between">
                                    <label for="optionalFollowupToggle" class="label mb-0">Allow Clarifying AI Follow-ups:</label>
                                    <input type="checkbox" id="optionalFollowupToggle" class="toggle-switch">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Guidance & Scope Review Panel -->
                <div class="guidance-column">
                    <div id="guidanceCard" class="guidance-card">
                        <h4 id="guidanceTitle">Smart Suggestions</h4>
                        <p id="guidanceText">As you fill out the form, we'll provide helpful tips and information right here.</p>
                    </div>

                    <!-- Scope Review Staging Panel (Moved here) -->
                    <div id="scopeOutputPanel" class="form-section hidden" data-guidance-id="scopeOutput">
                        <div class="form-section-header">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                            <h4>Scope Review Staging Panel</h4>
                        </div>
                        <div class="form-section-content">
                            <div class="form-group">
                                <label for="scopeNarrative" class="label">Scope Narrative (Editable):</label>
                                <textarea id="scopeNarrative" class="input-field" rows="4"></textarea>
                            </div>
                            
                            <!-- EDITED: Inclusions and Exclusions side-by-side -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label for="scopeInclusions" class="label">Inclusions (Editable):</label>
                                    <textarea id="scopeInclusions" class="input-field" rows="6"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="scopeExclusions" class="label">Exclusions (Editable):</label>
                                    <textarea id="scopeExclusions" class="input-field" rows="6"></textarea>
                                </div>
                            </div>
                            
                            <h5 class="label mt-4 mb-2">Recommended Task Line Items (Review & Accept)</h5>
                            <div id="taskLineItemsContainer" class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                                <!-- Dynamic task line items rendered here -->
                                <p class="p-3 text-sm text-gray-500">No tasks generated yet. Click 'Analyze Documents' to start.</p>
                            </div>
                            
                            <div class="mt-4 flex gap-2 justify-end">
                                <button class="btn btn-secondary-outline btn-sm">Export Scope (DOCX)</button>
                                <button class="btn btn-secondary-outline btn-sm">Export Scope (PDF)</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Labor Rates (Unchanged) -->
        <div id="wizardStep2" class="wizard-step-content hidden">
            <div class="text-center mb-8">
                <h2 class="step-title">Labor Rates & Skills</h2>
                <p class="step-subtitle mx-auto">Configure the hourly rates for each skill level within your selected trades. You can also add or remove custom skill levels.</p>
            </div>
            <div id="dynamicLaborRateInputs" class="max-w-3xl mx-auto flex flex-col gap-6"> 
                <!-- Dynamic content here -->
            </div>
            <div class="mt-6 text-center">
                <a href="#" class="advanced-link" id="advancedLink">Show Advanced Skill Options</a>
            </div>
            <div id="advancedSkillLevelControls" class="hidden mt-6 pt-6 border-t border-gray-200 dark:border-gray-700 max-w-md mx-auto">
                <h4 class="font-semibold text-lg mb-3 text-center">Add Custom Skill to All Trades</h4>
                <div class="form-group">
                    <label for="newSkillTitle" class="label">New Skill Title:</label>
                    <input type="text" id="newSkillTitle" class="input-field" placeholder="e.g., Lead Journeyman">
                </div>
                <div class="form-group">
                    <label for="newSkillRate" class="label">New Skill Rate ($/hr):</label>
                    <input type="number" id="newSkillRate" class="input-field" value="0">
                </div>
                <button id="addSkillLevelBtn" class="btn btn-primary w-full mt-2">Add Skill Level</button>
            </div>
        </div>

        <!-- Step 4: Financial Settings (Updated step number) -->
        <div id="wizardStep4" class="wizard-step-content hidden">
            <div class="text-center mb-8">
                <h2 class="step-title">Final Project Settings</h2>
                <p class="step-subtitle mx-auto">Apply your standard markups and other financial considerations to finalize the estimate's pricing structure.</p>
            </div>
            <div class="max-w-2xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                <div class="form-group" data-guidance-id="overhead">
                    <label for="overhead" class="label">Overhead (%):</label>
                    <input type="number" id="overhead" class="input-field" value="10" step="0.01">
                </div>
                <div class="form-group" data-guidance-id="profitMargin">
                    <label for="profitMargin" class="label">Desired Profit (%):</label>
                    <input type="number" id="profitMargin" class="input-field" value="15" step="0.01">
                </div>
                <div class="form-group" data-guidance-id="materialMarkup">
                    <label for="materialMarkup" class="label">Material Markup (%):</label>
                    <input type="number" id="materialMarkup" class="input-field" value="10" step="0.01">
                </div>
                <div class="form-group" data-guidance-id="salesTax">
                    <label for="salesTax" class="label">Sales Tax (%):</label>
                    <input type="number" id="salesTax" class="input-field" value="0" step="0.01">
                </div>
                <div class="form-group" data-guidance-id="contingency">
                    <label for="miscellaneous" class="label">Contingency / Misc. (%):</label>
                    <input type="number" id="miscellaneous" class="input-field" value="5" step="0.01">
                </div>
                <div class="form-group" data-guidance-id="additionalConsiderations">
                    <label class="label">Additional Considerations:</label>
                    <div class="flex items-center">
                        <input type="number" id="additionalConsiderationsValue" class="input-field rounded-r-none" value="0" step="0.01">
                        <button id="toggleAdditionalConsiderationsBtn" type="button" class="btn btn-primary h-full rounded-l-none" style="min-width: 50px; padding: 0.5rem;">%</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overwrite Confirmation Modal (Shared by Step 3) -->
        <div id="overwriteConfirmationModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-20 hidden flex items-center justify-center">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm">
                <h3 class="text-xl font-bold mb-4 text-red-600 dark:text-red-400">Confirm Overwrite</h3>
                <p class="text-gray-700 dark:text-gray-300 mb-6">Generating a new scope will **replace the previous version**. Continue?</p>
                <div class="flex justify-end gap-3">
                    <button id="cancelOverwriteBtn" class="btn btn-secondary">Cancel</button>
                    <button id="overwriteConfirmBtn" class="btn btn-red">Yes, Overwrite</button>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="wizard-navigation">
            <button id="backToEntryBtn" class="btn btn-red">Back to Start</button>
            <div>
                <button id="prevStepBtn" class="btn btn-primary hidden">Previous</button>
                <button id="nextStepBtn" class="btn btn-primary">Next Step</button>
                <button id="startEstimatingBtn" class="btn btn-green hidden">Finish & Start Estimating</button>
            </div>
        </div>
    </div>
</div>
